CREATE DATABASE VENDAS_SUCOS;

USE VENDAS_SUCOS;

CREATE TABLE TAB_FATURAMENTO
(DATA_VENDA DATE NULL, TOTAL_VENDA FLOAT);

CREATE TABLE ITENS_NOTAS (NUMERO VARCHAR(5), CODIGO VARCHAR(10), QUANTIDADE INT, PRECO FLOAT);

CREATE TABLE NOTAS (NUMERO VARCHAR(5), DATA_VENDA DATE, CPF VARCHAR(11), MATRICULA VARCHAR(5), IMPORTO FLOAT);

DELIMITER //
CREATE TRIGGER TG_CALCULA_FATURAMENTO_INSERT AFTER INSERT ON ITENS_NOTAS
FOR EACH ROW BEGIN
    DELETE FROM TAB_FATURAMENTO;
    INSERT INTO TAB_FATURAMENTO
    SELECT A.DATA_VENDA, SUM(B.QUANTIDADE * B.PRECO) AS TOTAL_VENDA FROM
    NOTAS A INNER JOIN ITENS_NOTAS B
    ON A.NUMERO = B.NUMERO
    GROUP BY A.DATA_VENDA;
END //

/* TRIGGER RESPONS√ÅVEL POR FAZER O CALCULO DO TOTAL DE VENDAS, SEMPRE QUE INSERIR DADOS NAS TABELAS 'ITENS_NOTAS E NOTAS' */

